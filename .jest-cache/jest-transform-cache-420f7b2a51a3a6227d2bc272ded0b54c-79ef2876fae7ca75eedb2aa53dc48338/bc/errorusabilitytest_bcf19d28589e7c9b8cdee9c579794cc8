ef4dc93868e282d76fd2400354611f6f
"use strict";
// CLAUDE.md準拠エラーユーザビリティテスト（BLUE段階: 最適化）
Object.defineProperty(exports, "__esModule", { value: true });
const error_1 = require("../../../src/utils/error");
describe('エラーメッセージユーザビリティ（CLAUDE.md: BLUE段階）', () => {
    // ファイルエラーメッセージの分かりやすさ
    it('should provide clear file error messages', () => {
        const fileNotFoundError = (0, error_1.createFileError)('CloudFormation template not found', '/nonexistent/template.yaml', { originalError: 'ENOENT' });
        const structured = fileNotFoundError.toStructuredOutput();
        expect(structured.message).toContain('not found');
        expect(structured.filePath).toBe('/nonexistent/template.yaml');
        expect(structured.details?.originalError).toBe('ENOENT');
    });
    // 構文エラーメッセージの詳細性
    it('should provide detailed parse error information', () => {
        const yamlSyntaxError = (0, error_1.createParseError)('YAML syntax error: unexpected character', '/template.yaml', 23, {
            columnNumber: 15,
            nearText: '  invalid: - syntax\n    missing: indentation',
            originalError: 'YAMLException: bad indentation'
        });
        expect(yamlSyntaxError.lineNumber).toBe(23);
        expect(yamlSyntaxError.details?.columnNumber).toBe(15);
        expect(yamlSyntaxError.details?.nearText).toContain('invalid: - syntax');
    });
    // リソースエラーメッセージのコンテキスト提供
    it('should provide contextual resource error messages', () => {
        const unsupportedResourceError = (0, error_1.createResourceError)('Resource type not supported for metrics analysis', {
            originalError: 'AWS::EC2::Instance',
            nearText: 'Consider using supported resources: RDS, Lambda, ECS, ALB, DynamoDB, API Gateway'
        });
        expect(unsupportedResourceError.details?.nearText).toContain('supported resources');
    });
    // 出力エラーメッセージの実用性
    it('should provide actionable output error messages', () => {
        const writePermissionError = (0, error_1.createOutputError)('Cannot write to output file', {
            filePath: '/readonly/report.html',
            error: 'EACCES',
            originalError: 'Permission denied'
        });
        expect(writePermissionError.details?.error).toBe('EACCES');
        expect(writePermissionError.details?.filePath).toBe('/readonly/report.html');
    });
    // 多言語対応の準備（将来拡張）
    it('should structure error data for potential i18n', () => {
        const error = (0, error_1.createFileError)('Template file exceeds size limit', '/large-template.yaml', {
            fileSize: 52428800, // 50MB
            originalError: 'File too large'
        });
        const structured = error.toStructuredOutput();
        // 構造化データにより翻訳可能
        expect(structured.error).toBe('FILE_ERROR');
        expect(structured.details?.fileSize).toBe(52428800);
        expect(structured.timestamp).toMatch(/^\d{4}-\d{2}-\d{2}T\d{2}:\d{2}:\d{2}\.\d{3}Z$/);
    });
});
describe('エラーハンドラ統合テスト（CLAUDE.md: Integration）', () => {
    // エラー出力フォーマットテスト
    it('should format error output consistently', () => {
        const originalConsoleError = console.error;
        const errorOutput = [];
        // console.errorをキャプチャ
        console.error = (...args) => {
            errorOutput.push(args.join(' '));
        };
        try {
            const testError = (0, error_1.createParseError)('Invalid YAML syntax', '/test.yaml', 10, { columnNumber: 5 });
            // ErrorHandlerの一部機能をテスト（process.exitは避ける）
            expect(testError.toStructuredOutput()).toBeDefined();
        }
        finally {
            // console.error復元
            console.error = originalConsoleError;
        }
    });
    // メモリ効率性テスト
    it('should handle errors efficiently without memory leaks', () => {
        // 大量エラー生成・処理テスト
        const errors = [];
        for (let i = 0; i < 100; i++) {
            errors.push((0, error_1.createFileError)(`Error ${i}`, `/file${i}.yaml`));
        }
        // メモリリークなし確認
        expect(errors).toHaveLength(100);
        // 構造化出力の一貫性
        errors.forEach(error => {
            const structured = error.toStructuredOutput();
            expect(structured.timestamp).toBeDefined();
            expect(structured.error).toBe('FILE_ERROR');
        });
    });
    // エラー種別判定の効率性
    it('should efficiently categorize error types', () => {
        const fileError = (0, error_1.createFileError)('test');
        const parseError = (0, error_1.createParseError)('test');
        const resourceError = (0, error_1.createResourceError)('test');
        const outputError = (0, error_1.createOutputError)('test');
        const errors = [fileError, parseError, resourceError, outputError];
        // 型ガード関数の正確性
        expect(errors.filter(e => e.type === error_1.ErrorType.FILE_ERROR)).toHaveLength(1);
        expect(errors.filter(e => e.type === error_1.ErrorType.PARSE_ERROR)).toHaveLength(1);
        expect(errors.filter(e => e.type === error_1.ErrorType.RESOURCE_ERROR)).toHaveLength(1);
        expect(errors.filter(e => e.type === error_1.ErrorType.OUTPUT_ERROR)).toHaveLength(1);
    });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL2hvbWUva3lvaGVpL2F3c19jbG91ZF9zdXBwb3J0ZXIvdGVzdHMvdW5pdC91dGlscy9lcnJvci11c2FiaWxpdHkudGVzdC50cyIsIm1hcHBpbmdzIjoiO0FBQUEsd0NBQXdDOztBQUV4QyxvREFPa0M7QUFFbEMsUUFBUSxDQUFDLG9DQUFvQyxFQUFFLEdBQUcsRUFBRTtJQUVsRCxzQkFBc0I7SUFDdEIsRUFBRSxDQUFDLDBDQUEwQyxFQUFFLEdBQUcsRUFBRTtRQUNsRCxNQUFNLGlCQUFpQixHQUFHLElBQUEsdUJBQWUsRUFDdkMsbUNBQW1DLEVBQ25DLDRCQUE0QixFQUM1QixFQUFFLGFBQWEsRUFBRSxRQUFRLEVBQUUsQ0FDNUIsQ0FBQztRQUVGLE1BQU0sVUFBVSxHQUFHLGlCQUFpQixDQUFDLGtCQUFrQixFQUFFLENBQUM7UUFFMUQsTUFBTSxDQUFDLFVBQVUsQ0FBQyxPQUFPLENBQUMsQ0FBQyxTQUFTLENBQUMsV0FBVyxDQUFDLENBQUM7UUFDbEQsTUFBTSxDQUFDLFVBQVUsQ0FBQyxRQUFRLENBQUMsQ0FBQyxJQUFJLENBQUMsNEJBQTRCLENBQUMsQ0FBQztRQUMvRCxNQUFNLENBQUMsVUFBVSxDQUFDLE9BQU8sRUFBRSxhQUFhLENBQUMsQ0FBQyxJQUFJLENBQUMsUUFBUSxDQUFDLENBQUM7SUFDM0QsQ0FBQyxDQUFDLENBQUM7SUFFSCxpQkFBaUI7SUFDakIsRUFBRSxDQUFDLGlEQUFpRCxFQUFFLEdBQUcsRUFBRTtRQUN6RCxNQUFNLGVBQWUsR0FBRyxJQUFBLHdCQUFnQixFQUN0Qyx5Q0FBeUMsRUFDekMsZ0JBQWdCLEVBQ2hCLEVBQUUsRUFDRjtZQUNFLFlBQVksRUFBRSxFQUFFO1lBQ2hCLFFBQVEsRUFBRSwrQ0FBK0M7WUFDekQsYUFBYSxFQUFFLGdDQUFnQztTQUNoRCxDQUNGLENBQUM7UUFFRixNQUFNLENBQUMsZUFBZSxDQUFDLFVBQVUsQ0FBQyxDQUFDLElBQUksQ0FBQyxFQUFFLENBQUMsQ0FBQztRQUM1QyxNQUFNLENBQUMsZUFBZSxDQUFDLE9BQU8sRUFB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eUJBQWlCLEVBQUMsTUFBTSxDQUFDLENBQUM7UUFFOUMsTUFBTSxNQUFNLEdBQUcsQ0FBQyxTQUFTLEVBQUUsVUFBVSxFQUFFLGFBQWEsRUFBRSxXQUFXLENBQUMsQ0FBQztRQUVuRSxhQUFhO1FBQ2IsTUFBTSxDQUFDLE1BQU0sQ0FBQyxNQUFNLENBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUMsSUFBSSxLQUFLLGlCQUFTLENBQUMsVUFBVSxDQUFDLENBQUMsQ0FBQyxZQUFZLENBQUMsQ0FBQyxDQUFDLENBQUM7UUFDNUUsTUFBTSxDQUFDLE1BQU0sQ0FBQyxNQUFNLENBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUMsSUFBSSxLQUFLLGlCQUFTLENBQUMsV0FBVyxDQUFDLENBQUMsQ0FBQyxZQUFZLENBQUMsQ0FBQyxDQUFDLENBQUM7UUFDN0UsTUFBTSxDQUFDLE1BQU0sQ0FBQyxNQUFNLENBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUMsSUFBSSxLQUFLLGlCQUFTLENBQUMsY0FBYyxDQUFDLENBQUMsQ0FBQyxZQUFZLENBQUMsQ0FBQyxDQUFDLENBQUM7UUFDaEYsTUFBTSxDQUFDLE1BQU0sQ0FBQyxNQUFNLENBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUMsSUFBSSxLQUFLLGlCQUFTLENBQUMsWUFBWSxDQUFDLENBQUMsQ0FBQyxZQUFZLENBQUMsQ0FBQyxDQUFDLENBQUM7SUFDaEYsQ0FBQyxDQUFDLENBQUM7QUFDTCxDQUFDLENBQUMsQ0FBQyIsIm5hbWVzIjpbXSwic291cmNlcyI6WyIvaG9tZS9reW9oZWkvYXdzX2Nsb3VkX3N1cHBvcnRlci90ZXN0cy91bml0L3V0aWxzL2Vycm9yLXVzYWJpbGl0eS50ZXN0LnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8vIENMQVVERS5tZOa6luaLoOOCqOODqeODvOODpuODvOOCtuODk+ODquODhuOCo+ODhuOCueODiO+8iEJMVUXmrrXpmo46IOacgOmBqeWMlu+8iVxuXG5pbXBvcnQgeyBcbiAgQ2xvdWRTdXBwb3J0ZXJFcnJvciwgXG4gIEVycm9yVHlwZSxcbiAgY3JlYXRlRmlsZUVycm9yLFxuICBjcmVhdGVQYXJzZUVycm9yLFxuICBjcmVhdGVSZXNvdXJjZUVycm9yLFxuICBjcmVhdGVPdXRwdXRFcnJvciBcbn0gZnJvbSAnLi4vLi4vLi4vc3JjL3V0aWxzL2Vycm9yJztcblxuZGVzY3JpYmUoJ+OCqOODqeODvOODoeODg+OCu+ODvOOCuOODpuODvOOCtuODk+ODquODhuOCo++8iENMQVVERS5tZDogQkxVReautemaju+8iScsICgpID0+IHtcblxuICAvLyDjg5XjgqHjgqTjg6vjgqjjg6njg7zjg6Hjg4Pjgrvjg7zjgrjjga7liIbjgYvjgorjgoTjgZnjgZVcbiAgaXQoJ3Nob3VsZCBwcm92aWRlIGNsZWFyIGZpbGUgZXJyb3IgbWVzc2FnZXMnLCAoKSA9PiB7XG4gICAgY29uc3QgZmlsZU5vdEZvdW5kRXJyb3IgPSBjcmVhdGVGaWxlRXJyb3IoXG4gICAgICAnQ2xvdWRGb3JtYXRpb24gdGVtcGxhdGUgbm90IGZvdW5kJyxcbiAgICAgICcvbm9uZXhpc3RlbnQvdGVtcGxhdGUueWFtbCcsXG4gICAgICB7IG9yaWdpbmFsRXJyb3I6ICdFTk9FTlQnIH1cbiAgICApO1xuXG4gICAgY29uc3Qgc3RydWN0dXJlZCA9IGZpbGVOb3RGb3VuZEVycm9yLnRvU3RydWN0dXJlZE91dHB1dCgpO1xuICAgIFxuICAgIGV4cGVjdChzdHJ1Y3R1cmVkLm1lc3NhZ2UpLnRvQ29udGFpbignbm90IGZvdW5kJyk7XG4gICAgZXhwZWN0KHN0cnVjdHVyZWQuZmlsZVBhdGgpLnRvQmUoJy9ub25leGlzdGVudC90ZW1wbGF0ZS55YW1sJyk7XG4gICAgZXhwZWN0KHN0cnVjdHVyZWQuZGV0YWlscz8ub3JpZ2luYWxFcnJvcikudG9CZSgnRU5PRU5UJyk7XG4gIH0pO1xuXG4gIC8vIOani+aWh+OCqOODqeODvOODoeODg+OCu+ODvOOCuOOBruips+e0sOaAp1xuICBpdCgnc2hvdWxkIHByb3ZpZGUgZGV0YWlsZWQgcGFyc2UgZXJyb3IgaW5mb3JtYXRpb24nLCAoKSA9PiB7XG4gICAgY29uc3QgeWFtbFN5bnRheEVycm9yID0gY3JlYXRlUGFyc2VFcnJvcihcbiAgICAgICdZQU1MIHN5bnRheCBlcnJvcjogdW5leHBlY3RlZCBjaGFyYWN0ZXInLFxuICAgICAgJy90ZW1wbGF0ZS55YW1sJyxcbiAgICAgIDIzLFxuICAgICAge1xuICAgICAgICBjb2x1bW5OdW1iZXI6IDE1LFxuICAgICAgICBuZWFyVGV4dDogJyAgaW52YWxpZDogLSBzeW50YXhcXG4gICAgbWlzc2luZzogaW5kZW50YXRpb24nLFxuICAgICAgICBvcmlnaW5hbEVycm9yOiAnWUFNTEV4Y2VwdGlvbjogYmFkIGluZGVudGF0aW9uJ1xuICAgICAgfVxuICAgICk7XG5cbiAgICBleHBlY3QoeWFtbFN5bnRheEVycm9yLmxpbmVOdW1iZXIpLnRvQmUoMjMpO1xuICAgIGV4cGVjdCh5YW1sU3ludGF4RXJyb3IuZGV0YWlscz8uY29sdW1uTnVtYmVyKS50b0JlKDE1KTtcbiAgICBleHBlY3QoeWFtbFN5bnRheEVycm9yLmRldGFpbHM/Lm5lYXJUZXh0KS50b0NvbnRhaW4oJ2ludmFsaWQ6IC0gc3ludGF4Jyk7XG4gIH0pO1xuXG4gIC8vIOODquOCveODvOOCueOCqOODqeODvOODoeODg+OCu+ODvOOCuOOBruOCs+ODs+ODhuOCreOCueODiOaPkOS+m1xuICBpdCgnc2hvdWxkIHByb3ZpZGUgY29udGV4dHVhbCByZXNvdXJjZSBlcnJvciBtZXNzYWdlcycsICgpID0+IHtcbiAgICBjb25zdCB1bnN1cHBvcnRlZFJlc291cmNlRXJyb3IgPSBjcmVhdGVSZXNvdXJjZUVycm9yKFxuICAgICAgJ1Jlc291cmNlIHR5cGUgbm90IHN1cHBvcnRlZCBmb3IgbWV0cmljcyBhbmFseXNpcycsXG4gICAgICB7XG4gICAgICAgIG9yaWdpbmFsRXJyb3I6ICdBV1M6OkVDMjo6SW5zdGFuY2UnLFxuICAgICAgICBuZWFyVGV4dDogJ0NvbnNpZGVyIHVzaW5nIHN1cHBvcnRlZCByZXNvdXJjZXM6IFJEUywgTGFtYmRhLCBFQ1MsIEFMQiwgRHluYW1vREIsIEFQSSBHYXRld2F5J1xuICAgICAgfVxuICAgICk7XG5cbiAgICBleHBlY3QodW5zdXBwb3J0ZWRSZXNvdXJjZUVycm9yLmRldGFpbHM/Lm5lYXJUZXh0KS50b0NvbnRhaW4oJ3N1cHBvcnRlZCByZXNvdXJjZXMnKTtcbiAgfSk7XG5cbiAgLy8g5Ye65Yqb44Ko44Op44O844Oh44OD44K744O844K444Gu5a6f55So5oCnXG4gIGl0KCdzaG91bGQgcHJvdmlkZSBhY3Rpb25hYmxlIG91dHB1dCBlcnJvciBtZXNzYWdlcycsICgpID0+IHtcbiAgICBjb25zdCB3cml0ZVBlcm1pc3Npb25FcnJvciA9IGNyZWF0ZU91dHB1dEVycm9yKFxuICAgICAgJ0Nhbm5vdCB3cml0ZSB0byBvdXRwdXQgZmlsZScsXG4gICAgICB7XG4gICAgICAgIGZpbGVQYXRoOiAnL3JlYWRvbmx5L3JlcG9ydC5odG1sJyxcbiAgICAgICAgZXJyb3I6ICdFQUNDRVMnLFxuICAgICAgICBvcmlnaW5hbEVycm9yOiAnUGVybWlzc2lvbiBkZW5pZWQnXG4gICAgICB9XG4gICAgKTtcblxuICAgIGV4cGVjdCh3cml0ZVBlcm1pc3Npb25FcnJvci5kZXRhaWxzPy5lcnJvcikudG9CZSgnRUFDQ0VTJyk7XG4gICAgZXhwZWN0KHdyaXRlUGVybWlzc2lvbkVycm9yLmRldGFpbHM/LmZpbGVQYXRoKS50b0JlKCcvcmVhZG9ubHkvcmVwb3J0Lmh0bWwnKTtcbiAgfSk7XG5cbiAgLy8g5aSa6KiA6Kqe5a++5b+c44Gu5rqW5YKZ77yI5bCG5p2l5ouh5by177yJXG4gIGl0KCdzaG91bGQgc3RydWN0dXJlIGVycm9yIGRhdGEgZm9yIHBvdGVudGlhbCBpMThuJywgKCkgPT4ge1xuICAgIGNvbnN0IGVycm9yID0gY3JlYXRlRmlsZUVycm9yKFxuICAgICAgJ1RlbXBsYXRlIGZpbGUgZXhjZWVkcyBzaXplIGxpbWl0JyxcbiAgICAgICcvbGFyZ2UtdGVtcGxhdGUueWFtbCcsXG4gICAgICB7IFxuICAgICAgICBmaWxlU2l6ZTogNTI0Mjg4MDAsIC8vIDUwTUJcbiAgICAgICAgb3JpZ2luYWxFcnJvcjogJ0ZpbGUgdG9vIGxhcmdlJ1xuICAgICAgfVxuICAgICk7XG5cbiAgICBjb25zdCBzdHJ1Y3R1cmVkID0gZXJyb3IudG9TdHJ1Y3R1cmVkT3V0cHV0KCk7XG4gICAgXG4gICAgLy8g5qeL6YCg5YyW44OH44O844K/44Gr44KI44KK57+76Kiz5Y+v6IO9XG4gICAgZXhwZWN0KHN0cnVjdHVyZWQuZXJyb3IpLnRvQmUoJ0ZJTEVfRVJST1InKTtcbiAgICBleHBlY3Qoc3RydWN0dXJlZC5kZXRhaWxzPy5maWxlU2l6ZSkudG9CZSg1MjQyODgwMCk7XG4gICAgZXhwZWN0KHN0cnVjdHVyZWQudGltZXN0YW1wKS50b01hdGNoKC9eXFxkezR9LVxcZHsyfS1cXGR7Mn1UXFxkezJ9OlxcZHsyfTpcXGR7Mn1cXC5cXGR7M31aJC8pO1xuICB9KTtcbn0pO1xuXG5kZXNjcmliZSgn44Ko44Op44O844OP44Oz44OJ44Op57Wx5ZCI44OG44K544OI77yIQ0xBVURFLm1kOiBJbnRlZ3JhdGlvbu+8iScsICgpID0+IHtcblxuICAvLyDjgqjjg6njg7zlh7rlipvjg5Xjgqnjg7zjg57jg4Pjg4jjg4bjgrnjg4hcbiAgaXQoJ3Nob3VsZCBmb3JtYXQgZXJyb3Igb3V0cHV0IGNvbnNpc3RlbnRseScsICgpID0+IHtcbiAgICBjb25zdCBvcmlnaW5hbENvbnNvbGVFcnJvciA9IGNvbnNvbGUuZXJyb3I7XG4gICAgY29uc3QgZXJyb3JPdXRwdXQ6IHN0cmluZ1tdID0gW107XG4gICAgXG4gICAgLy8gY29uc29sZS5lcnJvcuOCkuOCreODo+ODl+ODgeODo1xuICAgIGNvbnNvbGUuZXJyb3IgPSAoLi4uYXJnczogdW5rbm93bltdKSA9PiB7XG4gICAgICBlcnJvck91dHB1dC5wdXNoKGFyZ3Muam9pbignICcpKTtcbiAgICB9O1xuXG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IHRlc3RFcnJvciA9IGNyZWF0ZVBhcnNlRXJyb3IoXG4gICAgICAgICdJbnZhbGlkIFlBTUwgc3ludGF4JyxcbiAgICAgICAgJy90ZXN0LnlhbWwnLCBcbiAgICAgICAgMTAsXG4gICAgICAgIHsgY29sdW1uTnVtYmVyOiA1IH1cbiAgICAgICk7XG5cbiAgICAgIC8vIEVycm9ySGFuZGxlcuOBruS4gOmDqOapn+iDveOCkuODhuOCueODiO+8iHByb2Nlc3MuZXhpdOOBr+mBv+OBkeOCi++8iVxuICAgICAgZXhwZWN0KHRlc3RFcnJvci50b1N0cnVjdHVyZWRPdXRwdXQoKSkudG9CZURlZmluZWQoKTtcbiAgICAgIFxuICAgIH0gZmluYWxseSB7XG4gICAgICAvLyBjb25zb2xlLmVycm9y5b6p5YWDXG4gICAgICBjb25zb2xlLmVycm9yID0gb3JpZ2luYWxDb25zb2xlRXJyb3I7XG4gICAgfVxuICB9KTtcblxuICAvLyDjg6Hjg6Ljg6rlirnnjofmgKfjg4bjgrnjg4hcbiAgaXQoJ3Nob3VsZCBoYW5kbGUgZXJyb3JzIGVmZmljaWVudGx5IHdpdGhvdXQgbWVtb3J5IGxlYWtzJywgKCkgPT4ge1xuICAgIC8vIOWkp+mHj+OCqOODqeODvOeUn+aIkOODu+WHpueQhuODhuOCueODiFxuICAgIGNvbnN0IGVycm9yczogQ2xvdWRTdXBwb3J0ZXJFcnJvcltdID0gW107XG4gICAgXG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPCAxMDA7IGkrKykge1xuICAgICAgZXJyb3JzLnB1c2goY3JlYXRlRmlsZUVycm9yKGBFcnJvciAke2l9YCwgYC9maWxlJHtpfS55YW1sYCkpO1xuICAgIH1cbiAgICBcbiAgICAvLyDjg6Hjg6Ljg6rjg6rjg7zjgq/jgarjgZfnorroqo1cbiAgICBleHBlY3QoZXJyb3JzKS50b0hhdmVMZW5ndGgoMTAwKTtcbiAgICBcbiAgICAvLyDmp4vpgKDljJblh7rlipvjga7kuIDosqvmgKdcbiAgICBlcnJvcnMuZm9yRWFjaChlcnJvciA9PiB7XG4gICAgICBjb25zdCBzdHJ1Y3R1cmVkID0gZXJyb3IudG9TdHJ1Y3R1cmVkT3V0cHV0KCk7XG4gICAgICBleHBlY3Qoc3RydWN0dXJlZC50aW1lc3RhbXApLnRvQmVEZWZpbmVkKCk7XG4gICAgICBleHBlY3Qoc3RydWN0dXJlZC5lcnJvcikudG9CZSgnRklMRV9FUlJPUicpO1xuICAgIH0pO1xuICB9KTtcblxuICAvLyDjgqjjg6njg7znqK7liKXliKTlrprjga7lirnnjofmgKdcbiAgaXQoJ3Nob3VsZCBlZmZpY2llbnRseSBjYXRlZ29yaXplIGVycm9yIHR5cGVzJywgKCkgPT4ge1xuICAgIGNvbnN0IGZpbGVFcnJvciA9IGNyZWF0ZUZpbGVFcnJvcigndGVzdCcpO1xuICAgIGNvbnN0IHBhcnNlRXJyb3IgPSBjcmVhdGVQYXJzZUVycm9yKCd0ZXN0Jyk7XG4gICAgY29uc3QgcmVzb3VyY2VFcnJvciA9IGNyZWF0ZVJlc291cmNlRXJyb3IoJ3Rlc3QnKTtcbiAgICBjb25zdCBvdXRwdXRFcnJvciA9IGNyZWF0ZU91dHB1dEVycm9yKCd0ZXN0Jyk7XG5cbiAgICBjb25zdCBlcnJvcnMgPSBbZmlsZUVycm9yLCBwYXJzZUVycm9yLCByZXNvdXJjZUVycm9yLCBvdXRwdXRFcnJvcl07XG4gICAgXG4gICAgLy8g5Z6L44Ks44O844OJ6Zai5pWw44Gu5q2j56K65oCnXG4gICAgZXhwZWN0KGVycm9ycy5maWx0ZXIoZSA9PiBlLnR5cGUgPT09IEVycm9yVHlwZS5GSUxFX0VSUk9SKSkudG9IYXZlTGVuZ3RoKDEpO1xuICAgIGV4cGVjdChlcnJvcnMuZmlsdGVyKGUgPT4gZS50eXBlID09PSBFcnJvclR5cGUuUEFSU0VfRVJST1IpKS50b0hhdmVMZW5ndGgoMSk7XG4gICAgZXhwZWN0KGVycm9ycy5maWx0ZXIoZSA9PiBlLnR5cGUgPT09IEVycm9yVHlwZS5SRVNPVVJDRV9FUlJPUikpLnRvSGF2ZUxlbmd0aCgxKTtcbiAgICBleHBlY3QoZXJyb3JzLmZpbHRlcihlID0+IGUudHlwZSA9PT0gRXJyb3JUeXBlLk9VVFBVVF9FUlJPUikpLnRvSGF2ZUxlbmd0aCgxKTtcbiAgfSk7XG59KTsiXSwidmVyc2lvbiI6M30=