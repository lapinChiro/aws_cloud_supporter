8491d447f9592c2f0c1d993f4c1cf74b
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.ErrorHandler = exports.CloudSupporterError = exports.ErrorType = void 0;
exports.isFileError = isFileError;
exports.isParseError = isParseError;
exports.isResourceError = isResourceError;
exports.isOutputError = isOutputError;
exports.createFileError = createFileError;
exports.createParseError = createParseError;
exports.createResourceError = createResourceError;
exports.createOutputError = createOutputError;
// シンプルな色付き出力（CLAUDE.md: KISS、外部依存最小化）
const colors = {
    red: (text) => `\x1b[31m${text}\x1b[0m`,
    yellow: (text) => `\x1b[33m${text}\x1b[0m`,
    blue: (text) => `\x1b[34m${text}\x1b[0m`,
    gray: (text) => `\x1b[90m${text}\x1b[0m`
};
// シンプルなエラータイプ列挙（CLAUDE.md: KISS）
var ErrorType;
(function (ErrorType) {
    ErrorType["FILE_ERROR"] = "FILE_ERROR";
    ErrorType["PARSE_ERROR"] = "PARSE_ERROR";
    ErrorType["RESOURCE_ERROR"] = "RESOURCE_ERROR";
    ErrorType["OUTPUT_ERROR"] = "OUTPUT_ERROR";
})(ErrorType || (exports.ErrorType = ErrorType = {}));
// CLAUDE.md準拠カスタムエラークラス（型安全、No any types）
class CloudSupporterError extends Error {
    type;
    details;
    filePath;
    lineNumber;
    constructor(type, message, details, filePath, lineNumber) {
        super(message);
        this.type = type;
        this.details = details;
        this.filePath = filePath;
        this.lineNumber = lineNumber;
        this.name = 'CloudSupporterError';
        // スタックトレース最適化（CLAUDE.md: clarity over cleverness）
        if (Error.captureStackTrace) {
            Error.captureStackTrace(this, CloudSupporterError);
        }
    }
    // 構造化エラー出力（型安全）
    toStructuredOutput() {
        return {
            error: this.type,
            message: this.message,
            details: this.details,
            filePath: this.filePath,
            lineNumber: this.lineNumber,
            timestamp: new Date().toISOString()
        };
    }
    // エラー詳細の型安全な取得
    getDetailsString() {
        if (!this.details)
            return undefined;
        try {
            return JSON.stringify(this.details, null, 2);
        }
        catch {
            return '[Error: Cannot stringify details]';
        }
    }
}
exports.CloudSupporterError = CloudSupporterError;
// CLAUDE.md準拠エラーハンドラ（KISS原則、単一責任）
class ErrorHandler {
    // メインエラーハンドリング（UNIX Philosophy: do one thing well）
    static handle(error) {
        if (error instanceof CloudSupporterError) {
            this.handleCloudSupporterError(error);
        }
        else {
            this.handleUnexpectedError(error);
        }
        // 適切な終了コードで終了
        const exitCode = this.getExitCode(error);
        process.exit(exitCode);
    }
    // 構造化エラー処理（型安全性）
    static handleCloudSupporterError(error) {
        // エラーメッセージ（視認性重視）
        console.error(colors.red(`❌ ${error.message}`));
        // ファイル情報（デバッグ支援）
        if (error.filePath) {
            const locationInfo = error.lineNumber
                ? `${error.filePath}:${error.lineNumber}`
                : error.filePath;
            console.error(colors.gray(`   File: ${locationInfo}`));
        }
        // エラー詳細（開発者支援）
        const detailsString = error.getDetailsString();
        if (detailsString) {
            console.error(colors.gray(`   Details: ${detailsString}`));
        }
        // 解決提案（ユーザビリティ向上）
        const suggestion = this.getSuggestion(error.type);
        if (suggestion) {
            console.error(colors.blue(`💡 ${suggestion}`));
        }
    }
    // 予期せぬエラー処理（フォールバック）
    static handleUnexpectedError(error) {
        console.error(colors.red(`❌ Unexpected error: ${error.message}`));
        // 開発時のデバッグ支援
        if (process.env.NODE_ENV === 'development' || process.env.VERBOSE === 'true') {
            console.error(colors.gray(`   Stack: ${error.stack}`));
        }
    }
    // ユーザーフレンドリーな提案（CLAUDE.md: ユーザビリティ）
    static getSuggestion(type) {
        const suggestions = {
            [ErrorType.FILE_ERROR]: "Check if file exists and has read permissions",
            [ErrorType.PARSE_ERROR]: "Validate CloudFormation template syntax using 'cfn-lint' or AWS CloudFormation Designer",
            [ErrorType.RESOURCE_ERROR]: "Verify resource properties match AWS CloudFormation specification",
            [ErrorType.OUTPUT_ERROR]: "Check output directory exists and has write permissions"
        };
        return suggestions[type];
    }
    // 適切な終了コード設定（UNIX Philosophy）
    static getExitCode(error) {
        if (!(error instanceof CloudSupporterError)) {
            return 1; // 予期せぬエラー
        }
        // エラータイプ別終了コード（シェル連携）
        const exitCodes = {
            [ErrorType.FILE_ERROR]: 1,
            [ErrorType.PARSE_ERROR]: 2,
            [ErrorType.RESOURCE_ERROR]: 3,
            [ErrorType.OUTPUT_ERROR]: 4
        };
        return exitCodes[error.type] ?? 1;
    }
    // ログ出力エラーハンドラ（開発時用）
    static logError(error, context) {
        const timestamp = new Date().toISOString();
        const contextStr = context ? `[${context}] ` : '';
        if (error instanceof CloudSupporterError) {
            const structured = error.toStructuredOutput();
            console.error(`${timestamp} ${contextStr}CloudSupporterError:`, structured);
        }
        else {
            console.error(`${timestamp} ${contextStr}Error:`, {
                message: error.message,
                stack: error.stack,
                name: error.name
            });
        }
    }
}
exports.ErrorHandler = ErrorHandler;
// エラータイプ判定ヘルパー（型安全性）
function isFileError(error) {
    return error instanceof CloudSupporterError && error.type === ErrorType.FILE_ERROR;
}
function isParseError(error) {
    return error instanceof CloudSupporterError && error.type === ErrorType.PARSE_ERROR;
}
function isResourceError(error) {
    return error instanceof CloudSupporterError && error.type === ErrorType.RESOURCE_ERROR;
}
function isOutputError(error) {
    return error instanceof CloudSupporterError && error.type === ErrorType.OUTPUT_ERROR;
}
// エラー作成ヘルパー関数（DRY原則）
function createFileError(message, filePath, details) {
    return new CloudSupporterError(ErrorType.FILE_ERROR, message, details, filePath);
}
function createParseError(message, filePath, lineNumber, details) {
    return new CloudSupporterError(ErrorType.PARSE_ERROR, message, details, filePath, lineNumber);
}
function createResourceError(message, details) {
    return new CloudSupporterError(ErrorType.RESOURCE_ERROR, message, details);
}
function createOutputError(message, details) {
    return new CloudSupporterError(ErrorType.OUTPUT_ERROR, message, details);
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL2hvbWUva3lvaGVpL2F3c19jbG91ZF9zdXBwb3J0ZXIvc3JjL3V0aWxzL2Vycm9yLnRzIiwibWFwcGluZ3MiOiI7OztBQWlLQSxrQ0FFQztBQUVELG9DQUVDO0FBRUQsMENBRUM7QUFFRCxzQ0FFQztBQUdELDBDQUVDO0FBRUQsNENBRUM7QUFFRCxrREFFQztBQUVELDhDQUVDO0FBN0xELHNDQUFzQztBQUN0QyxNQUFNLE1BQU0sR0FBRztJQUNiLEdBQUcsRUFBRSxDQUFDLElBQVksRUFBRSxFQUFFLENBQUMsV0FBVyxJQUFJLFNBQVM7SUFDL0MsTUFBTSxFQUFFLENBQUMsSUFBWSxFQUFFLEVBQUUsQ0FBQyxXQUFXLElBQUksU0FBUztJQUNsRCxJQUFJLEVBQUUsQ0FBQyxJQUFZLEVBQUUsRUFBRSxDQUFDLFdBQVcsSUFBSSxTQUFTO0lBQ2hELElBQUksRUFBRSxDQUFDLElBQVksRUFBRSxFQUFFLENBQUMsV0FBVyxJQUFJLFNBQVM7Q0FDakQsQ0FBQztBQUVGLGlDQUFpQztBQUNqQyxJQUFZLFNBS1g7QUFMRCxXQUFZLFNBQVM7SUFDbkIsc0NBQXlCLENBQUE7SUFDekIsd0NBQTJCLENBQUE7SUFDM0IsOENBQWlDLENBQUE7SUFDakMsMENBQTZCLENBQUE7QUFDL0IsQ0FBQyxFQUxXLFNBQVMseUJBQVQsU0FBUyxRQUtwQjtBQUVELDBDQUEwQztBQUMxQyxNQUFhLG1CQUFvQixTQUFRLEtBQUs7SUFFMUI7SUFFQTtJQUNBO0lBQ0E7SUFMbEIsWUFDa0IsSUFBZSxFQUMvQixPQUFlLEVBQ0MsT0FBc0IsRUFDdEIsUUFBaUIsRUFDakIsVUFBbUI7UUFFbkMsS0FBSyxDQUFDLE9BQU8sQ0FBQyxDQUFDO1FBTkMsU0FBSSxHQUFKLElBQUksQ0FBVztRQUVmLFlBQU8sR0FBUCxPQUFPLENBQWU7UUFDdEIsYUFBUSxHQUFSLFFBQVEsQ0FBUztRQUNqQixlQUFVLEdBQVYsVUFBVSxDQUFTO1FBR25DLElBQUksQ0FBQyxJQUFJLEdBQUcscUJBQXFCLENBQUM7UUFFbEMsa0RBQWtEO1FBQ2xELElBQUksS0FBSyxDQUFDLGlCQUFpQixFQUFFLENBQUM7WUFDNUIsS0FBSyxDQUFDLGlCQUFpQixDQUFDLElBQUksRUFBRSxtQkFBbUIsQ0FBQyxDQUFDO1FBQ3JELENBQUM7SUFDSCxDQUFDO0lBRUQsZ0JBQWdCO0lBQ2hCLGtCQUFrQjtRQUNoQixPQUFPO1lBQ0wsS0FBSyxFQUFFLElBQUksQ0FBQyxJQUFJO1lBQ2hCLE9BQU8sRUFBRSxJQUFJLENBQUMsT0FBTztZQUNyQixPQUFPLEVBQUUsSUFBSSxDQUFDLE9BQU87WUFDckIsUUFBUSxFQUFFLElBQUksQ0FBQyxRQUFRO1lBQ3ZCLFVBQVUsRUFBRSxJQUFJLENBQUMsVUFBVTtZQUMzQixTQUFTLEVBQUUsSUFBSSxJQUFJLEVBQUUsQ0FBQyxXQUFXLEVBQUU7U0FDcEMsQ0FBQztJQUNKLENBQUM7SUFFRCxlQUFlO0lBQ2YsZ0JBQWdCO1FBQ2QsSUFBSSxDQUFDLElBQUksQ0FBQyxPQUFPO1lBQUUsT0FBTyxTQUFTLENBQUM7UUFFcEMsSUFBSSxDQUFDO1lBQ0gsT0FBTyxJQUFJLENBQUMsU0FBUyxDQUFDLElBQUksQ0FBQyxPQUFPLEVBQUUsSUFBSSxFQUFFLENBQUMsQ0FBQyxDQUFDO1FBQy9DLENBQUM7UUFBQyxNQUFNLENBQUM7WUFDUCxPQUFPLG1DQUFtQyxDQUFDO1FBQzdDLENBQUM7SUFDSCxDQUFDO0NBQ0Y7QUF2Q0Qsa0RBdUNDO0FBRUQsa0NBQWtDO0FBQ2xDLE1BQWEsWUFBWTtJQUV2QixtREFBbUQ7SUFDbkQsTUFBTSxDQUFDLE1BQU0sQ0FBQyxLQUFZO1FBQ3hCLElBQUksS0FBSyxZQUFZLG1CQUFtQixFQUFFLENBQUM7WUFDekMsSUFBSSxDQUFDLHlCQUF5QixDQUFDLEtBQUssQ0FBQyxDQUFDO1FBQ3hDLENBQUM7YUFBTSxDQUFDO1lBQ04sSUFBSSxDQUFDLHFCQUFxQixDQUFDLEtBQUssQ0FBQyxDQUFDO1FBQ3BDLENBQUM7UUFFRCxjQUFjO1FBQ2QsTUFBTSxRQUFRLEdBQUcsSUFBSSxDQUFDLFdBQVcsQ0FBQyxLQUFLLENBQUMsQ0FBQztRQUN6QyxPQUFPLENBQUMsSUFBSSxDQUFDLFFBQVEsQ0FBQyxDQUFDO0lBQ3pCLENBQUM7SUFFRCxpQkFBaUI7SUFDVCxNQUFNLENBQUMseUJBQXlCLENBQUMsS0FBMEI7UUFDakUsa0JBQWtCO1FBQ2xCLE9BQU8sQ0FBQyxLQUFLLENBQUMsTUFBTSxDQUFDLEdBQUcsQ0FBQyxLQUFLLEtBQUssQ0FBQyxPQUFPLEVBQUUsQ0FBQyxDQUFDLENBQUM7UUFFaEQsaUJBQWlCO1FBQ2pCLElBQUksS0FBSyxDQUFDLFFBQVEsRUFBRSxDQUFDO1lBQ25CLE1BQU0sWUFBWSxHQUFHLEtBQUssQ0FBQyxVQUFVO2dCQUNuQyxDQUFDLENBQUMsR0FBRyxLQUFLLENBQUMsUUFBUSxJQUFJLEtBQUssQ0FBQyxVQUFVLEVBQUU7Z0JBQ3pDLENBQUMsQ0FBQyxLQUFLLENBQUMsUUFBUSxDQUFDO1lBQ25CLE9BQU8sQ0FBQyxLQUFLLENBQUMsTUFBTSxDQUFDLElBQUksQ0FBQyxZQUFZLFlBQVksRUFBRSxDQUFDLENBQUMsQ0FBQztRQUN6RCxDQUFDO1FBRUQsZUFBZTtRQUNmLE1BQU0sYUFBYSxHQUFHLEtBQUssQ0FBQyxnQkFBZ0IsRUFBRSxDQUFDO1FBQy9DLElBQUksYUFBYSxFQUFFLENBQUM7WUFDbEIsT0FBTyxDQUFDLEtBQUssQ0FBQyxNQUFNLENBQUMsSUFBSSxDQUFDLGVBQWUsYUFBYSxFQUFFLENBQUMsQ0FBQyxDQUFDO1FBQzdELENBQUM7UUFFRCxrQkFBa0I7UUFDbEIsTUFBTSxVQUFVLEdBQUcsSUFBSSxDQUFDLGFBQWEsQ0FBQyxLQUFLLENBQUMsSUFBSSxDQUFDLENBQUM7UUFDbEQsSUFBSSxVQUFVLEVBQUUsQ0FBQztZQUNmLE9BQU8sQ0FBQyxLQUFLLENBQUMsTUFBTSxDQUFDLElBQUksQ0FBQyxNQUFNLFVBQVUsRUFBRSxDQUFDLENBQUMsQ0FBQztRQUNqRCxDQUFDO0lBQ0gsQ0FBQztJQUVELHFCQUFxQjtJQUNiLE1BQU0sQ0FBQyxxQkFBcUIsQ0FBQyxLQUFZO1FBQy9DLE9BQU8sQ0FBQyxLQUFLLENBQUMsTUFBTSxDQUFDLEdBQUcsQ0FBQyx1QkFBdUIsS0FBSyxDQUFDLE9BQU8sRUFBRSxDQUFDLENBQUMsQ0FBQztRQUVsRSxhQUFhO1FBQ2IsSUFBSSxPQUFPLENBQUMsR0FBRyxDQUFDLFFBQVEsS0FBSyxhQUFhLElBQUksT0FBTyxDQUFDLEdBQUcsQ0FBQyxPQUFPLEtBQUssTUFBTSxFQUFFLENBQUM7WUFDN0UsT0FBTyxDQUFDLEtBQUssQ0FBQyxNQUFNLENBQUMsSUFBSSxDQUFDLGFBQWEsS0FBSyxDQUFDLEtBQUssRUFBRSxDQUFDLENBQUMsQ0FBQztRQUN6RCxDQUFDO0lBQ0gsQ0FBQztJQUVELG9DQUFvQztJQUM1QixNQUFNLENBQUMsYUFBYSxDQUFDLElBQWU7UUFDMUMsTUFBTSxXQUFXLEdBQThCO1lBQzdDLENBQUMsU0FBUyxDQUFDLFVBQVUsQ0FBQyxFQUFFLCtDQUErQztZQUN2RSxDQUFDLFNBQVMsQ0FBQyxXQUFXLENBQUMsRUFBRSx5RkFBeUY7WUFDbEgsQ0FBQyxTQUFTLENBQUMsY0FBYyxDQUFDLEVBQUUsbUVBQW1FO1lBQy9GLENBQUMsU0FBUyxDQUFDLFlBQVksQ0FBQyxFQUFFLHlEQUF5RDtTQUNwRixDQUFDO1FBRUYsT0FBTyxXQUFXLENBQUMsSUFBSSxDQUFDLENBQUM7SUFDM0IsQ0FBQztJQUVELDhCQUE4QjtJQUN0QixNQUFNLENBQUMsV0FBVyxDQUFDLEtBQVk7UUFDckMsSUFBSSxDQUFDLENBQUMsS0FBSyxZQUFZLG1CQUFtQixDQUFDLEVBQUUsQ0FBQztZQUM1QyxPQUFPLENBQUMsQ0FBQyxDQUFDLFVBQVU7UUFDdEIsQ0FBQztRQUVELHNCQUFzQjtRQUN0QixNQUFNLFNBQVMsR0FBOEI7WUFDM0MsQ0FBQyxTQUFTLENBQUMsVUFBVSxDQUFDLEVBQUUsQ0FBQztZQUN6QixDQUFDLFNBQVMsQ0FBQyxXQUFXLENBQUMsRUFBRSxDQUFDO1lBQzFCLENBQUMsU0FBUyxDQUFDLGNBQWMsQ0FBQyxFQUFFLENBQUM7WUFDN0IsQ0FBQyxTQUFTLENBQUMsWUFBWSxDQUFDLEVBQUUsQ0FBQztTQUM1QixDQUFDO1FBRUYsT0FBTyxTQUFTLENBQUMsS0FBSyxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQztJQUNwQyxDQUFDO0lBRUQsb0JBQW9CO0lBQ3BCLE1BQU0sQ0FBQyxRQUFRLENBQUMsS0FBWSxFQUFFLE9BQWdCO1FBQzVDLE1BQU0sU0FBUyxHQUFHLElBQUksSUFBSSxFQUFFLENBQUMsV0FBVyxFQUFFLENBQUM7UUFDM0MsTUFBTSxVQUFVLEdBQUcsT0FBTyxDQUFDLENBQUMsQ0FBQyxJQUFJLE9BQU8sSUFBSSxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUM7UUFFbEQsSUFBSSxLQUFLLFlBQVksbUJBQW1CLEVBQUUsQ0FBQztZQUN6QyxNQUFNLFVBQVUsR0FBRyxLQUFLLENBQUMsa0JBQWtCLEVBQUUsQ0FBQztZQUM5QyxPQUFPLENBQUMsS0FBSyxDQUFDLEdBQUcsU0FBUyxJQUFJLFVBQVUsc0JBQXNCLEVBQUUsVUFBVSxDQUFDLENBQUM7UUFDOUUsQ0FBQzthQUFNLENBQUM7WUFDTixPQUFPLENBQUMsS0FBSyxDQUFDLEdBQUcsU0FBUyxJQUFJLFVBQVUsUUFBUSxFQUFFO2dCQUNoRCxPQUFPLEVBQUUsS0FBSyxDQUFDLE9BQU87Z0JBQ3RCLEtBQUssRUFBRSxLQUFLLENBQUMsS0FBSztnQkFDbEIsSUFBSSxFQUFFLEtBQUssQ0FBQyxJQUFJO2FBQ2pCLENBQUMsQ0FBQztRQUNMLENBQUM7SUFDSCxDQUFDO0NBQ0Y7QUFoR0Qsb0NBZ0dDO0FBRUQscUJBQXFCO0FBQ3JCLFNBQWdCLFdBQVcsQ0FBQyxLQUFjO0lBQ3hDLE9BQU8sS0FBSyxZQUFZLG1CQUFtQixJQUFJLEtBQUssQ0FBQyxJQUFJLEtBQUssU0FBUyxDQUFDLFVBQVUsQ0FBQztBQUNyRixDQUFDO0FBRUQsU0FBZ0IsWUFBWSxDQUFDLEtBQWM7SUFDekMsT0FBTyxLQUFLLFlBQVksbUJBQW1CLElBQUksS0FBSyxDQUFDLElBQUksS0FBSyxTQUFTLENBQUMsV0FBVyxDQUFDO0FBQ3RGLENBQUM7QUFFRCxTQUFnQixlQUFlLENBQUMsS0FBYztJQUM1QyxPQUFPLEtBQUssWUFBWSxtQkFBbUIsSUFBSSxLQUFLLENBQUMsSUFBSSxLQUFLLFNBQVMsQ0FBQyxjQUFjLENBQUM7QUFDekYsQ0FBQztBQUVELFNBQWdCLGFBQWEsQ0FBQyxLQUFjO0lBQzFDLE9BQU8sS0FBSyxZQUFZLG1CQUFtQixJQUFJLEtBQUssQ0FBQyxJQUFJLEtBQUssU0FBUyxDQUFDLFlBQVksQ0FBQztBQUN2RixDQUFDO0FBRUQscUJBQXFCO0FBQ3JCLFNBQWdCLGVBQWUsQ0FBQyxPQUFlLEVBQUUsUUFBaUIsRUFBRSxPQUFzQjtJQUN4RixPQUFPLElBQUksbUJBQW1CLENBQUMsU0FBUyxDQUFDLFVBQVUsRUFBRSxPQUFPLEVBQUUsT0FBTyxFQUFFLFFBQVEsQ0FBQyxDQUFDO0FBQ25GLENBQUM7QUFFRCxTQUFnQixnQkFBZ0IsQ0FBQyxPQUFlLEVBQUUsUUFBaUIsRUFBRSxVQUFtQixFQUFFLE9BQXNCO0lBQzlHLE9BQU8sSUFBSSxtQkFBbUIsQ0FBQyxTQUFTLENBQUMsV0FBVyxFQUFFLE9BQU8sRUFBRSxPQUFPLEVBQUUsUUFBUSxFQUFFLFVBQVUsQ0FBQyxDQUFDO0FBQ2hHLENBQUM7QUFFRCxTQUFnQixtQkFBbUIsQ0FBQyxPQUFlLEVBQUUsT0FBc0I7SUFDekUsT0FBTyxJQUFJLG1CQUFtQixDQUFDLFNBQVMsQ0FBQyxjQUFjLEVBQUUsT0FBTyxFQUFFLE9BQU8sQ0FBQyxDQUFDO0FBQzdFLENBQUM7QUFFRCxTQUFnQixpQkFBaUIsQ0FBQyxPQUFlLEVBQUUsT0FBc0I7SUFDdkUsT0FBTyxJQUFJLG1CQUFtQixDQUFDLFNBQVMsQ0FBQyxZQUFZLEVBQUUsT0FBTyxFQUFFLE9BQU8sQ0FBQyxDQUFDO0FBQzNFLENBQUMiLCJuYW1lcyI6W10sInNvdXJjZXMiOlsiL2hvbWUva3lvaGVpL2F3c19jbG91ZF9zdXBwb3J0ZXIvc3JjL3V0aWxzL2Vycm9yLnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8vIENMQVVERS5tZOa6luaLoOOCqOODqeODvOODj+ODs+ODieODquODs+OCsO+8iEtJU1Pljp/liYfjgIHlnovlronlhajmgKfjgIHjgrfjg7Pjg5fjg6voqK3oqIjvvIlcbmltcG9ydCB7IEVycm9yRGV0YWlscywgU3RydWN0dXJlZEVycm9yIH0gZnJvbSAnLi4vdHlwZXMvY29tbW9uJztcblxuLy8g44K344Oz44OX44Or44Gq6Imy5LuY44GN5Ye65Yqb77yIQ0xBVURFLm1kOiBLSVNT44CB5aSW6YOo5L6d5a2Y5pyA5bCP5YyW77yJXG5jb25zdCBjb2xvcnMgPSB7XG4gIHJlZDogKHRleHQ6IHN0cmluZykgPT4gYFxceDFiWzMxbSR7dGV4dH1cXHgxYlswbWAsXG4gIHllbGxvdzogKHRleHQ6IHN0cmluZykgPT4gYFxceDFiWzMzbSR7dGV4dH1cXHgxYlswbWAsXG4gIGJsdWU6ICh0ZXh0OiBzdHJpbmcpID0+IGBcXHgxYlszNG0ke3RleHR9XFx4MWJbMG1gLFxuICBncmF5OiAodGV4dDogc3RyaW5nKSA9PiBgXFx4MWJbOTBtJHt0ZXh0fVxceDFiWzBtYFxufTtcblxuLy8g44K344Oz44OX44Or44Gq44Ko44Op44O844K/44Kk44OX5YiX5oyZ77yIQ0xBVURFLm1kOiBLSVNT77yJXG5leHBvcnQgZW51bSBFcnJvclR5cGUge1xuICBGSUxFX0VSUk9SID0gJ0ZJTEVfRVJST1InLFxuICBQQVJTRV9FUlJPUiA9ICdQQVJTRV9FUlJPUicsXG4gIFJFU09VUkNFX0VSUk9SID0gJ1JFU09VUkNFX0VSUk9SJyxcbiAgT1VUUFVUX0VSUk9SID0gJ09VVFBVVF9FUlJPUidcbn1cblxuLy8gQ0xBVURFLm1k5rqW5oug44Kr44K544K/44Og44Ko44Op44O844Kv44Op44K577yI5Z6L5a6J5YWo44CBTm8gYW55IHR5cGVz77yJXG5leHBvcnQgY2xhc3MgQ2xvdWRTdXBwb3J0ZXJFcnJvciBleHRlbmRzIEVycm9yIHtcbiAgY29uc3RydWN0b3IoXG4gICAgcHVibGljIHJlYWRvbmx5IHR5cGU6IEVycm9yVHlwZSxcbiAgICBtZXNzYWdlOiBzdHJpbmcsXG4gICAgcHVibGljIHJlYWRvbmx5IGRldGFpbHM/OiBFcnJvckRldGFpbHMsXG4gICAgcHVibGljIHJlYWRvbmx5IGZpbGVQYXRoPzogc3RyaW5nLFxuICAgIHB1YmxpYyByZWFkb25seSBsaW5lTnVtYmVyPzogbnVtYmVyXG4gICkge1xuICAgIHN1cGVyKG1lc3NhZ2UpO1xuICAgIHRoaXMubmFtZSA9ICdDbG91ZFN1cHBvcnRlckVycm9yJztcbiAgICBcbiAgICAvLyDjgrnjgr/jg4Pjgq/jg4jjg6zjg7zjgrnmnIDpganljJbvvIhDTEFVREUubWQ6IGNsYXJpdHkgb3ZlciBjbGV2ZXJuZXNz77yJXG4gICAgaWYgKEVycm9yLmNhcHR1cmVTdGFja1RyYWNlKSB7XG4gICAgICBFcnJvci5jYXB0dXJlU3RhY2tUcmFjZSh0aGlzLCBDbG91ZFN1cHBvcnRlckVycm9yKTtcbiAgICB9XG4gIH1cblxuICAvLyDmp4vpgKDljJbjgqjjg6njg7zlh7rlipvvvIjlnovlronlhajvvIlcbiAgdG9TdHJ1Y3R1cmVkT3V0cHV0KCk6IFN0cnVjdHVyZWRFcnJvciB7XG4gICAgcmV0dXJuIHtcbiAgICAgIGVycm9yOiB0aGlzLnR5cGUsXG4gICAgICBtZXNzYWdlOiB0aGlzLm1lc3NhZ2UsXG4gICAgICBkZXRhaWxzOiB0aGlzLmRldGFpbHMsXG4gICAgICBmaWxlUGF0aDogdGhpcy5maWxlUGF0aCxcbiAgICAgIGxpbmVOdW1iZXI6IHRoaXMubGluZU51bWJlcixcbiAgICAgIHRpbWVzdGFtcDogbmV3IERhdGUoKS50b0lTT1N0cmluZygpXG4gICAgfTtcbiAgfVxuXG4gIC8vIOOCqOODqeODvOips+e0sOOBruWei+WuieWFqOOBquWPluW+l1xuICBnZXREZXRhaWxzU3RyaW5nKCk6IHN0cmluZyB8IHVuZGVmaW5lZCB7XG4gICAgaWYgKCF0aGlzLmRldGFpbHMpIHJldHVybiB1bmRlZmluZWQ7XG4gICAgXG4gICAgdHJ5IHtcbiAgICAgIHJldHVybiBKU09OLnN0cmluZ2lmeSh0aGlzLmRldGFpbHMsIG51bGwsIDIpO1xuICAgIH0gY2F0Y2gge1xuICAgICAgcmV0dXJuICdbRXJyb3I6IENhbm5vdCBzdHJpbmdpZnkgZGV0YWlsc10nO1xuICAgIH1cbiAgfVxufVxuXG4vLyBDTEFVREUubWTmupbmi6Djgqjjg6njg7zjg4/jg7Pjg4njg6nvvIhLSVNT5Y6f5YmH44CB5Y2Y5LiA6LKs5Lu777yJXG5leHBvcnQgY2xhc3MgRXJyb3JIYW5kbGVyIHtcbiAgXG4gIC8vIOODoeOCpOODs+OCqOODqeODvOODj+ODs+ODieODquODs+OCsO+8iFVOSVggUGhpbG9zb3BoeTogZG8gb25lIHRoaW5nIHdlbGzvvIlcbiAgc3RhdGljIGhhbmRsZShlcnJvcjogRXJyb3IpOiBuZXZlciB7XG4gICAgaWYgKGVycm9yIGluc3RhbmNlb2YgQ2xvdWRTdXBwb3J0ZXJFcnJvcikge1xuICAgICAgdGhpcy5oYW5kbGVDbG91ZFN1cHBvcnRlckVycm9yKGVycm9yKTtcbiAgICB9IGVsc2Uge1xuICAgICAgdGhpcy5oYW5kbGVVbmV4cGVjdGVkRXJyb3IoZXJyb3IpO1xuICAgIH1cbiAgICBcbiAgICAvLyDpganliIfjgarntYLkuobjgrPjg7zjg4njgafntYLkuoZcbiAgICBjb25zdCBleGl0Q29kZSA9IHRoaXMuZ2V0RXhpdENvZGUoZXJyb3IpO1xuICAgIHByb2Nlc3MuZXhpdChleGl0Q29kZSk7XG4gIH1cblxuICAvLyDmp4vpgKDljJbjgqjjg6njg7zlh6bnkIbvvIjlnovlronlhajmgKfvvIlcbiAgcHJpdmF0ZSBzdGF0aWMgaGFuZGxlQ2xvdWRTdXBwb3J0ZXJFcnJvcihlcnJvcjogQ2xvdWRTdXBwb3J0ZXJFcnJvcik6IHZvaWQge1xuICAgIC8vIOOCqOODqeODvOODoeODg+OCu+ODvOOCuO+8iOimluiqjeaAp+mHjeimlu+8iVxuICAgIGNvbnNvbGUuZXJyb3IoY29sb3JzLnJlZChg4p2MICR7ZXJyb3IubWVzc2FnZX1gKSk7XG4gICAgXG4gICAgLy8g44OV44Kh44Kk44Or5oOF5aCx77yI44OH44OQ44OD44Kw5pSv5o+077yJXG4gICAgaWYgKGVycm9yLmZpbGVQYXRoKSB7XG4gICAgICBjb25zdCBsb2NhdGlvbkluZm8gPSBlcnJvci5saW5lTnVtYmVyIFxuICAgICAgICA/IGAke2Vycm9yLmZpbGVQYXRofToke2Vycm9yLmxpbmVOdW1iZXJ9YFxuICAgICAgICA6IGVycm9yLmZpbGVQYXRoO1xuICAgICAgY29uc29sZS5lcnJvcihjb2xvcnMuZ3JheShgICAgRmlsZTogJHtsb2NhdGlvbkluZm99YCkpO1xuICAgIH1cbiAgICBcbiAgICAvLyDjgqjjg6njg7zoqbPntLDvvIjplovnmbrogIXmlK/mj7TvvIlcbiAgICBjb25zdCBkZXRhaWxzU3RyaW5nID0gZXJyb3IuZ2V0RGV0YWlsc1N0cmluZygpO1xuICAgIGlmIChkZXRhaWxzU3RyaW5nKSB7XG4gICAgICBjb25zb2xlLmVycm9yKGNvbG9ycy5ncmF5KGAgICBEZXRhaWxzOiAke2RldGFpbHNTdHJpbmd9YCkpO1xuICAgIH1cblxuICAgIC8vIOino+axuuaPkOahiO+8iOODpuODvOOCtuODk+ODquODhuOCo+WQkeS4iu+8iVxuICAgIGNvbnN0IHN1Z2dlc3Rpb24gPSB0aGlzLmdldFN1Z2dlc3Rpb24oZXJyb3IudHlwZSk7XG4gICAgaWYgKHN1Z2dlc3Rpb24pIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoY29sb3JzLmJsdWUoYPCfkqEgJHtzdWdnZXN0aW9ufWApKTtcbiAgICB9XG4gIH1cblxuICAvLyDkuojmnJ/jgZvjgazjgqjjg6njg7zlh6bnkIbvvIjjg5Xjgqnjg7zjg6vjg5Djg4Pjgq/vvIlcbiAgcHJpdmF0ZSBzdGF0aWMgaGFuZGxlVW5leHBlY3RlZEVycm9yKGVycm9yOiBFcnJvcik6IHZvaWQge1xuICAgIGNvbnNvbGUuZXJyb3IoY29sb3JzLnJlZChg4p2MIFVuZXhwZWN0ZWQgZXJyb3I6ICR7ZXJyb3IubWVzc2FnZX1gKSk7XG4gICAgXG4gICAgLy8g6ZaL55m65pmC44Gu44OH44OQ44OD44Kw5pSv5o+0XG4gICAgaWYgKHByb2Nlc3MuZW52Lk5PREVfRU5WID09PSAnZGV2ZWxvcG1lbnQnIHx8IHByb2Nlc3MuZW52LlZFUkJPU0UgPT09ICd0cnVlJykge1xuICAgICAgY29uc29sZS5lcnJvcihjb2xvcnMuZ3JheShgICAgU3RhY2s6ICR7ZXJyb3Iuc3RhY2t9YCkpO1xuICAgIH1cbiAgfVxuXG4gIC8vIOODpuODvOOCtuODvOODleODrOODs+ODieODquODvOOBquaPkOahiO+8iENMQVVERS5tZDog44Om44O844K244OT44Oq44OG44Kj77yJXG4gIHByaXZhdGUgc3RhdGljIGdldFN1Z2dlc3Rpb24odHlwZTogRXJyb3JUeXBlKTogc3RyaW5nIHwgdW5kZWZpbmVkIHtcbiAgICBjb25zdCBzdWdnZXN0aW9uczogUmVjb3JkPEVycm9yVHlwZSwgc3RyaW5nPiA9IHtcbiAgICAgIFtFcnJvclR5cGUuRklMRV9FUlJPUl06IFwiQ2hlY2sgaWYgZmlsZSBleGlzdHMgYW5kIGhhcyByZWFkIHBlcm1pc3Npb25zXCIsXG4gICAgICBbRXJyb3JUeXBlLlBBUlNFX0VSUk9SXTogXCJWYWxpZGF0ZSBDbG91ZEZvcm1hdGlvbiB0ZW1wbGF0ZSBzeW50YXggdXNpbmcgJ2Nmbi1saW50JyBvciBBV1MgQ2xvdWRGb3JtYXRpb24gRGVzaWduZXJcIixcbiAgICAgIFtFcnJvclR5cGUuUkVTT1VSQ0VfRVJST1JdOiBcIlZlcmlmeSByZXNvdXJjZSBwcm9wZXJ0aWVzIG1hdGNoIEFXUyBDbG91ZEZvcm1hdGlvbiBzcGVjaWZpY2F0aW9uXCIsXG4gICAgICBbRXJyb3JUeXBlLk9VVFBVVF9FUlJPUl06IFwiQ2hlY2sgb3V0cHV0IGRpcmVjdG9yeSBleGlzdHMgYW5kIGhhcyB3cml0ZSBwZXJtaXNzaW9uc1wiXG4gICAgfTtcbiAgICBcbiAgICByZXR1cm4gc3VnZ2VzdGlvbnNbdHlwZV07XG4gIH1cblxuICAvLyDpganliIfjgarntYLkuobjgrPjg7zjg4noqK3lrprvvIhVTklYIFBoaWxvc29waHnvvIlcbiAgcHJpdmF0ZSBzdGF0aWMgZ2V0RXhpdENvZGUoZXJyb3I6IEVycm9yKTogbnVtYmVyIHtcbiAgICBpZiAoIShlcnJvciBpbnN0YW5jZW9mIENsb3VkU3VwcG9ydGVyRXJyb3IpKSB7XG4gICAgICByZXR1cm4gMTsgLy8g5LqI5pyf44Gb44Gs44Ko44Op44O8XG4gICAgfVxuICAgIFxuICAgIC8vIOOCqOODqeODvOOCv+OCpOODl+WIpee1guS6huOCs+ODvOODie+8iOOCt+OCp+ODq+mAo+aQuu+8iVxuICAgIGNvbnN0IGV4aXRDb2RlczogUmVjb3JkPEVycm9yVHlwZSwgbnVtYmVyPiA9IHtcbiAgICAgIFtFcnJvclR5cGUuRklMRV9FUlJPUl06IDEsXG4gICAgICBbRXJyb3JUeXBlLlBBUlNFX0VSUk9SXTogMixcbiAgICAgIFtFcnJvclR5cGUuUkVTT1VSQ0VfRVJST1JdOiAzLFxuICAgICAgW0Vycm9yVHlwZS5PVVRQVVRfRVJST1JdOiA0XG4gICAgfTtcbiAgICBcbiAgICByZXR1cm4gZXhpdENvZGVzW2Vycm9yLnR5cGVdID8/IDE7XG4gIH1cblxuICAvLyDjg63jgrDlh7rlipvjgqjjg6njg7zjg4/jg7Pjg4njg6nvvIjplovnmbrmmYLnlKjvvIlcbiAgc3RhdGljIGxvZ0Vycm9yKGVycm9yOiBFcnJvciwgY29udGV4dD86IHN0cmluZyk6IHZvaWQge1xuICAgIGNvbnN0IHRpbWVzdGFtcCA9IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKTtcbiAgICBjb25zdCBjb250ZXh0U3RyID0gY29udGV4dCA/IGBbJHtjb250ZXh0fV0gYCA6ICcnO1xuICAgIFxuICAgIGlmIChlcnJvciBpbnN0YW5jZW9mIENsb3VkU3VwcG9ydGVyRXJyb3IpIHtcbiAgICAgIGNvbnN0IHN0cnVjdHVyZWQgPSBlcnJvci50b1N0cnVjdHVyZWRPdXRwdXQoKTtcbiAgICAgIGNvbnNvbGUuZXJyb3IoYCR7dGltZXN0YW1wfSAke2NvbnRleHRTdHJ9Q2xvdWRTdXBwb3J0ZXJFcnJvcjpgLCBzdHJ1Y3R1cmVkKTtcbiAgICB9IGVsc2Uge1xuICAgICAgY29uc29sZS5lcnJvcihgJHt0aW1lc3RhbXB9ICR7Y29udGV4dFN0cn1FcnJvcjpgLCB7XG4gICAgICAgIG1lc3NhZ2U6IGVycm9yLm1lc3NhZ2UsXG4gICAgICAgIHN0YWNrOiBlcnJvci5zdGFjayxcbiAgICAgICAgbmFtZTogZXJyb3IubmFtZVxuICAgICAgfSk7XG4gICAgfVxuICB9XG59XG5cbi8vIOOCqOODqeODvOOCv+OCpOODl+WIpOWumuODmOODq+ODkeODvO+8iOWei+WuieWFqOaAp++8iVxuZXhwb3J0IGZ1bmN0aW9uIGlzRmlsZUVycm9yKGVycm9yOiB1bmtub3duKTogZXJyb3IgaXMgQ2xvdWRTdXBwb3J0ZXJFcnJvciB7XG4gIHJldHVybiBlcnJvciBpbnN0YW5jZW9mIENsb3VkU3VwcG9ydGVyRXJyb3IgJiYgZXJyb3IudHlwZSA9PT0gRXJyb3JUeXBlLkZJTEVfRVJST1I7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBpc1BhcnNlRXJyb3IoZXJyb3I6IHVua25vd24pOiBlcnJvciBpcyBDbG91ZFN1cHBvcnRlckVycm9yIHtcbiAgcmV0dXJuIGVycm9yIGluc3RhbmNlb2YgQ2xvdWRTdXBwb3J0ZXJFcnJvciAmJiBlcnJvci50eXBlID09PSBFcnJvclR5cGUuUEFSU0VfRVJST1I7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBpc1Jlc291cmNlRXJyb3IoZXJyb3I6IHVua25vd24pOiBlcnJvciBpcyBDbG91ZFN1cHBvcnRlckVycm9yIHtcbiAgcmV0dXJuIGVycm9yIGluc3RhbmNlb2YgQ2xvdWRTdXBwb3J0ZXJFcnJvciAmJiBlcnJvci50eXBlID09PSBFcnJvclR5cGUuUkVTT1VSQ0VfRVJST1I7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBpc091dHB1dEVycm9yKGVycm9yOiB1bmtub3duKTogZXJyb3IgaXMgQ2xvdWRTdXBwb3J0ZXJFcnJvciB7XG4gIHJldHVybiBlcnJvciBpbnN0YW5jZW9mIENsb3VkU3VwcG9ydGVyRXJyb3IgJiYgZXJyb3IudHlwZSA9PT0gRXJyb3JUeXBlLk9VVFBVVF9FUlJPUjtcbn1cblxuLy8g44Ko44Op44O85L2c5oiQ44OY44Or44OR44O86Zai5pWw77yIRFJZ5Y6f5YmH77yJXG5leHBvcnQgZnVuY3Rpb24gY3JlYXRlRmlsZUVycm9yKG1lc3NhZ2U6IHN0cmluZywgZmlsZVBhdGg/OiBzdHJpbmcsIGRldGFpbHM/OiBFcnJvckRldGFpbHMpOiBDbG91ZFN1cHBvcnRlckVycm9yIHtcbiAgcmV0dXJuIG5ldyBDbG91ZFN1cHBvcnRlckVycm9yKEVycm9yVHlwZS5GSUxFX0VSUk9SLCBtZXNzYWdlLCBkZXRhaWxzLCBmaWxlUGF0aCk7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBjcmVhdGVQYXJzZUVycm9yKG1lc3NhZ2U6IHN0cmluZywgZmlsZVBhdGg/OiBzdHJpbmcsIGxpbmVOdW1iZXI/OiBudW1iZXIsIGRldGFpbHM/OiBFcnJvckRldGFpbHMpOiBDbG91ZFN1cHBvcnRlckVycm9yIHtcbiAgcmV0dXJuIG5ldyBDbG91ZFN1cHBvcnRlckVycm9yKEVycm9yVHlwZS5QQVJTRV9FUlJPUiwgbWVzc2FnZSwgZGV0YWlscywgZmlsZVBhdGgsIGxpbmVOdW1iZXIpO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gY3JlYXRlUmVzb3VyY2VFcnJvcihtZXNzYWdlOiBzdHJpbmcsIGRldGFpbHM/OiBFcnJvckRldGFpbHMpOiBDbG91ZFN1cHBvcnRlckVycm9yIHtcbiAgcmV0dXJuIG5ldyBDbG91ZFN1cHBvcnRlckVycm9yKEVycm9yVHlwZS5SRVNPVVJDRV9FUlJPUiwgbWVzc2FnZSwgZGV0YWlscyk7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBjcmVhdGVPdXRwdXRFcnJvcihtZXNzYWdlOiBzdHJpbmcsIGRldGFpbHM/OiBFcnJvckRldGFpbHMpOiBDbG91ZFN1cHBvcnRlckVycm9yIHtcbiAgcmV0dXJuIG5ldyBDbG91ZFN1cHBvcnRlckVycm9yKEVycm9yVHlwZS5PVVRQVVRfRVJST1IsIG1lc3NhZ2UsIGRldGFpbHMpO1xufSJdLCJ2ZXJzaW9uIjozfQ==