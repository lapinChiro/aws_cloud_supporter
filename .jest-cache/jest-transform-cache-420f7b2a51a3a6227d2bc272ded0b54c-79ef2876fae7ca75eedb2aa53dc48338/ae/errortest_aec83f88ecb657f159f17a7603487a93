5f84a5fa83444663d4ad900dbe86ace0
"use strict";
// CLAUDE.md準拠エラーハンドリングテスト（RED段階: KISS原則）
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
const fs_1 = require("fs");
const path_1 = __importDefault(require("path"));
describe('エラーハンドリングシステム（CLAUDE.md: KISS原則）', () => {
    // エラーハンドラ実装確認
    it('should implement ErrorHandler class', () => {
        const errorModule = require('../../../src/utils/error');
        expect(errorModule.ErrorHandler).toBeDefined();
        expect(errorModule.CloudSupporterError).toBeDefined();
        expect(errorModule.ErrorType).toBeDefined();
        expect(typeof errorModule.ErrorHandler.handle).toBe('function');
    });
    // エラータイプ列挙テスト
    it('should define proper error types', () => {
        const { ErrorType } = require('../../../src/utils/error');
        expect(ErrorType.FILE_ERROR).toBe('FILE_ERROR');
        expect(ErrorType.PARSE_ERROR).toBe('PARSE_ERROR');
        expect(ErrorType.RESOURCE_ERROR).toBe('RESOURCE_ERROR');
        expect(ErrorType.OUTPUT_ERROR).toBe('OUTPUT_ERROR');
    });
    // CloudSupporterErrorクラステスト
    it('should define CloudSupporterError class', () => {
        const { CloudSupporterError, ErrorType } = require('../../../src/utils/error');
        const testError = new CloudSupporterError(ErrorType.FILE_ERROR, 'Test error message', { originalError: 'test' }, '/test/path.yaml', 42);
        expect(testError).toBeInstanceOf(Error);
        expect(testError).toBeInstanceOf(CloudSupporterError);
        expect(testError.type).toBe(ErrorType.FILE_ERROR);
        expect(testError.message).toBe('Test error message');
        expect(testError.filePath).toBe('/test/path.yaml');
        expect(testError.lineNumber).toBe(42);
    });
    // エラーメッセージテスト（ユーザビリティ）
    it('should provide helpful error messages', () => {
        const { CloudSupporterError, ErrorType } = require('../../../src/utils/error');
        const fileError = new CloudSupporterError(ErrorType.FILE_ERROR, 'File not found');
        expect(fileError.message).toContain('File not found');
        const structured = fileError.toStructuredOutput();
        expect(structured.error).toBe('FILE_ERROR');
        expect(structured.message).toBe('File not found');
        expect(structured.timestamp).toBeDefined();
    });
    // 終了コードテスト（UNIX Philosophy）
    it('should set correct exit codes', () => {
        const { ErrorType } = require('../../../src/utils/error');
        // プライベートメソッドは直接テストできないが、
        // ErrorTypeごとの期待値を確認
        expect(ErrorType.FILE_ERROR).toBe('FILE_ERROR');
        expect(ErrorType.PARSE_ERROR).toBe('PARSE_ERROR');
        expect(ErrorType.RESOURCE_ERROR).toBe('RESOURCE_ERROR');
        expect(ErrorType.OUTPUT_ERROR).toBe('OUTPUT_ERROR');
    });
    // CLAUDE.md: No any types検証
    it('should not use any types in error handling', () => {
        const errorCode = (0, fs_1.readFileSync)(path_1.default.join(__dirname, '../../../src/utils/error.ts'), 'utf8');
        expect(errorCode).toHaveNoAnyTypes();
    });
    // KISS原則テスト（複雑性回避）
    it('should keep error handling simple (KISS principle)', () => {
        const { ErrorHandler } = require('../../../src/utils/error');
        // シンプルなAPIであることを確認
        expect(typeof ErrorHandler.handle).toBe('function');
        expect(typeof ErrorHandler.logError).toBe('function');
        // 複雑な継承やファクトリパターンを避けていることを確認
        expect(ErrorHandler.handle.length).toBeLessThanOrEqual(1); // 引数は1個のみ
    });
});
describe('エラー処理フロー（CLAUDE.md: 型安全性）', () => {
    // ファイルエラーヘルパー関数テスト
    it('should handle file errors properly', () => {
        const { createFileError, isFileError } = require('../../../src/utils/error');
        const fileError = createFileError('Template file not found', '/path/to/template.yaml', { fileSize: 0 });
        expect(isFileError(fileError)).toBe(true);
        expect(fileError.filePath).toBe('/path/to/template.yaml');
        expect(fileError.details?.fileSize).toBe(0);
    });
    // 構文エラーハンドリングテスト（行番号情報）
    it('should handle parse errors with line numbers', () => {
        const { createParseError, isParseError } = require('../../../src/utils/error');
        const parseError = createParseError('YAML syntax error', '/template.yaml', 15, { columnNumber: 10, nearText: 'invalid: syntax' });
        expect(isParseError(parseError)).toBe(true);
        expect(parseError.lineNumber).toBe(15);
        expect(parseError.details?.columnNumber).toBe(10);
    });
    // リソースエラーハンドリングテスト
    it('should handle resource errors gracefully', () => {
        const { createResourceError, isResourceError } = require('../../../src/utils/error');
        const resourceError = createResourceError('Unsupported resource type', { originalError: 'AWS::EC2::Instance not supported' });
        expect(isResourceError(resourceError)).toBe(true);
        expect(resourceError.details?.originalError).toContain('AWS::EC2::Instance');
    });
    // 出力エラーハンドリングテスト
    it('should handle output errors correctly', () => {
        const { createOutputError, isOutputError } = require('../../../src/utils/error');
        const outputError = createOutputError('Failed to write output file', { filePath: '/output/report.html', error: 'EACCES' });
        expect(isOutputError(outputError)).toBe(true);
        expect(outputError.details?.error).toBe('EACCES');
    });
    // 型ガード関数の型安全性テスト
    it('should provide type-safe error type guards', () => {
        const { createFileError, isFileError, isParseError, isResourceError, isOutputError } = require('../../../src/utils/error');
        const fileError = createFileError('test');
        expect(isFileError(fileError)).toBe(true);
        expect(isParseError(fileError)).toBe(false);
        expect(isResourceError(fileError)).toBe(false);
        expect(isOutputError(fileError)).toBe(false);
        // 非エラーオブジェクトでfalse
        expect(isFileError(null)).toBe(false);
        expect(isFileError(undefined)).toBe(false);
        expect(isFileError({})).toBe(false);
    });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL2hvbWUva3lvaGVpL2F3c19jbG91ZF9zdXBwb3J0ZXIvdGVzdHMvdW5pdC91dGlscy9lcnJvci50ZXN0LnRzIiwibWFwcGluZ3MiOiI7QUFBQSx5Q0FBeUM7Ozs7O0FBRXpDLDJCQUFrQztBQUNsQyxnREFBd0I7QUFFeEIsUUFBUSxDQUFDLGtDQUFrQyxFQUFFLEdBQUcsRUFBRTtJQUVoRCxjQUFjO0lBQ2QsRUFBRSxDQUFDLHFDQUFxQyxFQUFFLEdBQUcsRUFBRTtRQUM3QyxNQUFNLFdBQVcsR0FBRyxPQUFPLENBQUMsMEJBQTBCLENBQUMsQ0FBQztRQUV4RCxNQUFNLENBQUMsV0FBVyxDQUFDLFlBQVksQ0FBQyxDQUFDLFdBQVcsRUFBRSxDQUFDO1FBQy9DLE1BQU0sQ0FBQyxXQUFXLENBQUMsbUJBQW1CLENBQUMsQ0FBQyxXQUFXLEVBQUUsQ0FBQztRQUN0RCxNQUFNLENBQUMsV0FBVyxDQUFDLFNBQVMsQ0FBQyxDQUFDLFdBQVcsRUFBRSxDQUFDO1FBQzVDLE1BQU0sQ0FBQyxPQUFPLFdBQVcsQ0FBQyxZQUFZLENBQUMsTUFBTSxDQUFDLENBQUMsSUFBSSxDQUFDLFVBQVUsQ0FBQyxDQUFDO0lBQ2xFLENBQUMsQ0FBQyxDQUFDO0lBRUgsY0FBYztJQUNkLEVBQUUsQ0FBQyxrQ0FBa0MsRUFBRSxHQUFHLEVBQUU7UUFDMUMsTUFBTSxFQUFFLFNBQVMsRUFBRSxHQUFHLE9BQU8sQ0FBQywwQkFBMEIsQ0FBQyxDQUFDO1FBRTFELE1BQU0sQ0FBQyxTQUFTLENBQUMsVUFBVSxDQUFDLENBQUMsSUFBSSxDQUFDLFlBQVksQ0FBQyxDQUFDO1FBQ2hELE1BQU0sQ0FBQyxTQUFTLENBQUMsV0FBVyxDQUFDLENBQUMsSUFBSSxDQUFDLGFBQWEsQ0FBQyxDQUFDO1FBQ2xELE1BQU0sQ0FBQyxTQUFTLENBQUMsY0FBYyxDQUFDLENBQUMsSUFBSSxDQUFDLGdCQUFnQixDQUFDLENBQUM7UUFDeEQsTUFBTSxDQUFDLFNBQVMsQ0FBQyxZQUFZLENBQUMsQ0FBQyxJQUFJLENBQUMsY0FBYyxDQUFD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QUFXLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLENBQUM7UUFDdEMsTUFBTSxDQUFDLFdBQVcsQ0FBQyxTQUFTLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsQ0FBQztRQUMzQyxNQUFNLENBQUMsV0FBVyxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxDQUFDO0lBQ3RDLENBQUMsQ0FBQyxDQUFDO0FBQ0wsQ0FBQyxDQUFDLENBQUMiLCJuYW1lcyI6W10sInNvdXJjZXMiOlsiL2hvbWUva3lvaGVpL2F3c19jbG91ZF9zdXBwb3J0ZXIvdGVzdHMvdW5pdC91dGlscy9lcnJvci50ZXN0LnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8vIENMQVVERS5tZOa6luaLoOOCqOODqeODvOODj+ODs+ODieODquODs+OCsOODhuOCueODiO+8iFJFROautemajjogS0lTU+WOn+WJh++8iVxuXG5pbXBvcnQgeyByZWFkRmlsZVN5bmMgfSBmcm9tICdmcyc7XG5pbXBvcnQgcGF0aCBmcm9tICdwYXRoJztcblxuZGVzY3JpYmUoJ+OCqOODqeODvOODj+ODs+ODieODquODs+OCsOOCt+OCueODhuODoO+8iENMQVVERS5tZDogS0lTU+WOn+WJh++8iScsICgpID0+IHtcbiAgXG4gIC8vIOOCqOODqeODvOODj+ODs+ODieODqeWun+ijheeiuuiqjVxuICBpdCgnc2hvdWxkIGltcGxlbWVudCBFcnJvckhhbmRsZXIgY2xhc3MnLCAoKSA9PiB7XG4gICAgY29uc3QgZXJyb3JNb2R1bGUgPSByZXF1aXJlKCcuLi8uLi8uLi9zcmMvdXRpbHMvZXJyb3InKTtcbiAgICBcbiAgICBleHBlY3QoZXJyb3JNb2R1bGUuRXJyb3JIYW5kbGVyKS50b0JlRGVmaW5lZCgpO1xuICAgIGV4cGVjdChlcnJvck1vZHVsZS5DbG91ZFN1cHBvcnRlckVycm9yKS50b0JlRGVmaW5lZCgpO1xuICAgIGV4cGVjdChlcnJvck1vZHVsZS5FcnJvclR5cGUpLnRvQmVEZWZpbmVkKCk7XG4gICAgZXhwZWN0KHR5cGVvZiBlcnJvck1vZHVsZS5FcnJvckhhbmRsZXIuaGFuZGxlKS50b0JlKCdmdW5jdGlvbicpO1xuICB9KTtcblxuICAvLyDjgqjjg6njg7zjgr/jgqTjg5fliJfmjJnjg4bjgrnjg4hcbiAgaXQoJ3Nob3VsZCBkZWZpbmUgcHJvcGVyIGVycm9yIHR5cGVzJywgKCkgPT4ge1xuICAgIGNvbnN0IHsgRXJyb3JUeXBlIH0gPSByZXF1aXJlKCcuLi8uLi8uLi9zcmMvdXRpbHMvZXJyb3InKTtcbiAgICBcbiAgICBleHBlY3QoRXJyb3JUeXBlLkZJTEVfRVJST1IpLnRvQmUoJ0ZJTEVfRVJST1InKTtcbiAgICBleHBlY3QoRXJyb3JUeXBlLlBBUlNFX0VSUk9SKS50b0JlKCdQQVJTRV9FUlJPUicpO1xuICAgIGV4cGVjdChFcnJvclR5cGUuUkVTT1VSQ0VfRVJST1IpLnRvQmUoJ1JFU09VUkNFX0VSUk9SJyk7XG4gICAgZXhwZWN0KEVycm9yVHlwZS5PVVRQVVRfRVJST1IpLnRvQmUoJ09VVFBVVF9FUlJPUicpO1xuICB9KTtcblxuICAvLyBDbG91ZFN1cHBvcnRlckVycm9y44Kv44Op44K544OG44K544OIXG4gIGl0KCdzaG91bGQgZGVmaW5lIENsb3VkU3VwcG9ydGVyRXJyb3IgY2xhc3MnLCAoKSA9PiB7XG4gICAgY29uc3QgeyBDbG91ZFN1cHBvcnRlckVycm9yLCBFcnJvclR5cGUgfSA9IHJlcXVpcmUoJy4uLy4uLy4uL3NyYy91dGlscy9lcnJvcicpO1xuICAgIFxuICAgIGNvbnN0IHRlc3RFcnJvciA9IG5ldyBDbG91ZFN1cHBvcnRlckVycm9yKFxuICAgICAgRXJyb3JUeXBlLkZJTEVfRVJST1IsXG4gICAgICAnVGVzdCBlcnJvciBtZXNzYWdlJyxcbiAgICAgIHsgb3JpZ2luYWxFcnJvcjogJ3Rlc3QnIH0sXG4gICAgICAnL3Rlc3QvcGF0aC55YW1sJyxcbiAgICAgIDQyXG4gICAgKTtcbiAgICBcbiAgICBleHBlY3QodGVzdEVycm9yKS50b0JlSW5zdGFuY2VPZihFcnJvcik7XG4gICAgZXhwZWN0KHRlc3RFcnJvcikudG9CZUluc3RhbmNlT2YoQ2xvdWRTdXBwb3J0ZXJFcnJvcik7XG4gICAgZXhwZWN0KHRlc3RFcnJvci50eXBlKS50b0JlKEVycm9yVHlwZS5GSUxFX0VSUk9SKTtcbiAgICBleHBlY3QodGVzdEVycm9yLm1lc3NhZ2UpLnRvQmUoJ1Rlc3QgZXJyb3IgbWVzc2FnZScpO1xuICAgIGV4cGVjdCh0ZXN0RXJyb3IuZmlsZVBhdGgpLnRvQmUoJy90ZXN0L3BhdGgueWFtbCcpO1xuICAgIGV4cGVjdCh0ZXN0RXJyb3IubGluZU51bWJlcikudG9CZSg0Mik7XG4gIH0pO1xuXG4gIC8vIOOCqOODqeODvOODoeODg+OCu+ODvOOCuOODhuOCueODiO+8iOODpuODvOOCtuODk+ODquODhuOCo++8iVxuICBpdCgnc2hvdWxkIHByb3ZpZGUgaGVscGZ1bCBlcnJvciBtZXNzYWdlcycsICgpID0+IHtcbiAgICBjb25zdCB7IENsb3VkU3VwcG9ydGVyRXJyb3IsIEVycm9yVHlwZSB9ID0gcmVxdWlyZSgnLi4vLi4vLi4vc3JjL3V0aWxzL2Vycm9yJyk7XG4gICAgXG4gICAgY29uc3QgZmlsZUVycm9yID0gbmV3IENsb3VkU3VwcG9ydGVyRXJyb3IoXG4gICAgICBFcnJvclR5cGUuRklMRV9FUlJPUiwgXG4gICAgICAnRmlsZSBub3QgZm91bmQnXG4gICAgKTtcbiAgICBcbiAgICBleHBlY3QoZmlsZUVycm9yLm1lc3NhZ2UpLnRvQ29udGFpbignRmlsZSBub3QgZm91bmQnKTtcbiAgICBcbiAgICBjb25zdCBzdHJ1Y3R1cmVkID0gZmlsZUVycm9yLnRvU3RydWN0dXJlZE91dHB1dCgpO1xuICAgIGV4cGVjdChzdHJ1Y3R1cmVkLmVycm9yKS50b0JlKCdGSUxFX0VSUk9SJyk7XG4gICAgZXhwZWN0KHN0cnVjdHVyZWQubWVzc2FnZSkudG9CZSgnRmlsZSBub3QgZm91bmQnKTtcbiAgICBleHBlY3Qoc3RydWN0dXJlZC50aW1lc3RhbXApLnRvQmVEZWZpbmVkKCk7XG4gIH0pO1xuXG4gIC8vIOe1guS6huOCs+ODvOODieODhuOCueODiO+8iFVOSVggUGhpbG9zb3Boee+8iVxuICBpdCgnc2hvdWxkIHNldCBjb3JyZWN0IGV4aXQgY29kZXMnLCAoKSA9PiB7XG4gICAgY29uc3QgeyBFcnJvclR5cGUgfSA9IHJlcXVpcmUoJy4uLy4uLy4uL3NyYy91dGlscy9lcnJvcicpO1xuICAgIFxuICAgIC8vIOODl+ODqeOCpOODmeODvOODiOODoeOCveODg+ODieOBr+ebtOaOpeODhuOCueODiOOBp+OBjeOBquOBhOOBjOOAgVxuICAgIC8vIEVycm9yVHlwZeOBlOOBqOOBruacn+W+heWApOOCkueiuuiqjVxuICAgIGV4cGVjdChFcnJvclR5cGUuRklMRV9FUlJPUikudG9CZSgnRklMRV9FUlJPUicpO1xuICAgIGV4cGVjdChFcnJvclR5cGUuUEFSU0VfRVJST1IpLnRvQmUoJ1BBUlNFX0VSUk9SJyk7XG4gICAgZXhwZWN0KEVycm9yVHlwZS5SRVNPVVJDRV9FUlJPUikudG9CZSgnUkVTT1VSQ0VfRVJST1InKTtcbiAgICBleHBlY3QoRXJyb3JUeXBlLk9VVFBVVF9FUlJPUikudG9CZSgnT1VUUFVUX0VSUk9SJyk7XG4gIH0pO1xuXG4gIC8vIENMQVVERS5tZDogTm8gYW55IHR5cGVz5qSc6Ki8XG4gIGl0KCdzaG91bGQgbm90IHVzZSBhbnkgdHlwZXMgaW4gZXJyb3IgaGFuZGxpbmcnLCAoKSA9PiB7XG4gICAgY29uc3QgZXJyb3JDb2RlID0gcmVhZEZpbGVTeW5jKFxuICAgICAgcGF0aC5qb2luKF9fZGlybmFtZSwgJy4uLy4uLy4uL3NyYy91dGlscy9lcnJvci50cycpLFxuICAgICAgJ3V0ZjgnXG4gICAgKTtcbiAgICBleHBlY3QoZXJyb3JDb2RlKS50b0hhdmVOb0FueVR5cGVzKCk7XG4gIH0pO1xuXG4gIC8vIEtJU1Pljp/liYfjg4bjgrnjg4jvvIjopIfpm5HmgKflm57pgb/vvIlcbiAgaXQoJ3Nob3VsZCBrZWVwIGVycm9yIGhhbmRsaW5nIHNpbXBsZSAoS0lTUyBwcmluY2lwbGUpJywgKCkgPT4ge1xuICAgIGNvbnN0IHsgRXJyb3JIYW5kbGVyIH0gPSByZXF1aXJlKCcuLi8uLi8uLi9zcmMvdXRpbHMvZXJyb3InKTtcbiAgICBcbiAgICAvLyDjgrfjg7Pjg5fjg6vjgapBUEnjgafjgYLjgovjgZPjgajjgpLnorroqo1cbiAgICBleHBlY3QodHlwZW9mIEVycm9ySGFuZGxlci5oYW5kbGUpLnRvQmUoJ2Z1bmN0aW9uJyk7XG4gICAgZXhwZWN0KHR5cGVvZiBFcnJvckhhbmRsZXIubG9nRXJyb3IpLnRvQmUoJ2Z1bmN0aW9uJyk7XG4gICAgXG4gICAgLy8g6KSH6ZuR44Gq57aZ5om/44KE44OV44Kh44Kv44OI44Oq44OR44K/44O844Oz44KS6YG/44GR44Gm44GE44KL44GT44Go44KS56K66KqNXG4gICAgZXhwZWN0KEVycm9ySGFuZGxlci5oYW5kbGUubGVuZ3RoKS50b0JlTGVzc1RoYW5PckVxdWFsKDEpOyAvLyDlvJXmlbDjga8x5YCL44Gu44G/XG4gIH0pO1xufSk7XG5cbmRlc2NyaWJlKCfjgqjjg6njg7zlh6bnkIbjg5Xjg63jg7zvvIhDTEFVREUubWQ6IOWei+WuieWFqOaAp++8iScsICgpID0+IHtcblxuICAvLyDjg5XjgqHjgqTjg6vjgqjjg6njg7zjg5jjg6vjg5Hjg7zplqLmlbDjg4bjgrnjg4hcbiAgaXQoJ3Nob3VsZCBoYW5kbGUgZmlsZSBlcnJvcnMgcHJvcGVybHknLCAoKSA9PiB7XG4gICAgY29uc3QgeyBjcmVhdGVGaWxlRXJyb3IsIGlzRmlsZUVycm9yIH0gPSByZXF1aXJlKCcuLi8uLi8uLi9zcmMvdXRpbHMvZXJyb3InKTtcbiAgICBcbiAgICBjb25zdCBmaWxlRXJyb3IgPSBjcmVhdGVGaWxlRXJyb3IoXG4gICAgICAnVGVtcGxhdGUgZmlsZSBub3QgZm91bmQnLCBcbiAgICAgICcvcGF0aC90by90ZW1wbGF0ZS55YW1sJyxcbiAgICAgIHsgZmlsZVNpemU6IDAgfVxuICAgICk7XG4gICAgXG4gICAgZXhwZWN0KGlzRmlsZUVycm9yKGZpbGVFcnJvcikpLnRvQmUodHJ1ZSk7XG4gICAgZXhwZWN0KGZpbGVFcnJvci5maWxlUGF0aCkudG9CZSgnL3BhdGgvdG8vdGVtcGxhdGUueWFtbCcpO1xuICAgIGV4cGVjdChmaWxlRXJyb3IuZGV0YWlscz8uZmlsZVNpemUpLnRvQmUoMCk7XG4gIH0pO1xuXG4gIC8vIOani+aWh+OCqOODqeODvOODj+ODs+ODieODquODs+OCsOODhuOCueODiO+8iOihjOeVquWPt+aDheWgse+8iVxuICBpdCgnc2hvdWxkIGhhbmRsZSBwYXJzZSBlcnJvcnMgd2l0aCBsaW5lIG51bWJlcnMnLCAoKSA9PiB7XG4gICAgY29uc3QgeyBjcmVhdGVQYXJzZUVycm9yLCBpc1BhcnNlRXJyb3IgfSA9IHJlcXVpcmUoJy4uLy4uLy4uL3NyYy91dGlscy9lcnJvcicpO1xuICAgIFxuICAgIGNvbnN0IHBhcnNlRXJyb3IgPSBjcmVhdGVQYXJzZUVycm9yKFxuICAgICAgJ1lBTUwgc3ludGF4IGVycm9yJyxcbiAgICAgICcvdGVtcGxhdGUueWFtbCcsXG4gICAgICAxNSxcbiAgICAgIHsgY29sdW1uTnVtYmVyOiAxMCwgbmVhclRleHQ6ICdpbnZhbGlkOiBzeW50YXgnIH1cbiAgICApO1xuICAgIFxuICAgIGV4cGVjdChpc1BhcnNlRXJyb3IocGFyc2VFcnJvcikpLnRvQmUodHJ1ZSk7XG4gICAgZXhwZWN0KHBhcnNlRXJyb3IubGluZU51bWJlcikudG9CZSgxNSk7XG4gICAgZXhwZWN0KHBhcnNlRXJyb3IuZGV0YWlscz8uY29sdW1uTnVtYmVyKS50b0JlKDEwKTtcbiAgfSk7XG5cbiAgLy8g44Oq44K944O844K544Ko44Op44O844OP44Oz44OJ44Oq44Oz44Kw44OG44K544OIXG4gIGl0KCdzaG91bGQgaGFuZGxlIHJlc291cmNlIGVycm9ycyBncmFjZWZ1bGx5JywgKCkgPT4ge1xuICAgIGNvbnN0IHsgY3JlYXRlUmVzb3VyY2VFcnJvciwgaXNSZXNvdXJjZUVycm9yIH0gPSByZXF1aXJlKCcuLi8uLi8uLi9zcmMvdXRpbHMvZXJyb3InKTtcbiAgICBcbiAgICBjb25zdCByZXNvdXJjZUVycm9yID0gY3JlYXRlUmVzb3VyY2VFcnJvcihcbiAgICAgICdVbnN1cHBvcnRlZCByZXNvdXJjZSB0eXBlJyxcbiAgICAgIHsgb3JpZ2luYWxFcnJvcjogJ0FXUzo6RUMyOjpJbnN0YW5jZSBub3Qgc3VwcG9ydGVkJyB9XG4gICAgKTtcbiAgICBcbiAgICBleHBlY3QoaXNSZXNvdXJjZUVycm9yKHJlc291cmNlRXJyb3IpKS50b0JlKHRydWUpO1xuICAgIGV4cGVjdChyZXNvdXJjZUVycm9yLmRldGFpbHM/Lm9yaWdpbmFsRXJyb3IpLnRvQ29udGFpbignQVdTOjpFQzI6Okluc3RhbmNlJyk7XG4gIH0pO1xuXG4gIC8vIOWHuuWKm+OCqOODqeODvOODj+ODs+ODieODquODs+OCsOODhuOCueODiFxuICBpdCgnc2hvdWxkIGhhbmRsZSBvdXRwdXQgZXJyb3JzIGNvcnJlY3RseScsICgpID0+IHtcbiAgICBjb25zdCB7IGNyZWF0ZU91dHB1dEVycm9yLCBpc091dHB1dEVycm9yIH0gPSByZXF1aXJlKCcuLi8uLi8uLi9zcmMvdXRpbHMvZXJyb3InKTtcbiAgICBcbiAgICBjb25zdCBvdXRwdXRFcnJvciA9IGNyZWF0ZU91dHB1dEVycm9yKFxuICAgICAgJ0ZhaWxlZCB0byB3cml0ZSBvdXRwdXQgZmlsZScsXG4gICAgICB7IGZpbGVQYXRoOiAnL291dHB1dC9yZXBvcnQuaHRtbCcsIGVycm9yOiAnRUFDQ0VTJyB9XG4gICAgKTtcbiAgICBcbiAgICBleHBlY3QoaXNPdXRwdXRFcnJvcihvdXRwdXRFcnJvcikpLnRvQmUodHJ1ZSk7XG4gICAgZXhwZWN0KG91dHB1dEVycm9yLmRldGFpbHM/LmVycm9yKS50b0JlKCdFQUNDRVMnKTtcbiAgfSk7XG5cbiAgLy8g5Z6L44Ks44O844OJ6Zai5pWw44Gu5Z6L5a6J5YWo5oCn44OG44K544OIXG4gIGl0KCdzaG91bGQgcHJvdmlkZSB0eXBlLXNhZmUgZXJyb3IgdHlwZSBndWFyZHMnLCAoKSA9PiB7XG4gICAgY29uc3QgeyBcbiAgICAgIGNyZWF0ZUZpbGVFcnJvcixcbiAgICAgIGlzRmlsZUVycm9yLFxuICAgICAgaXNQYXJzZUVycm9yLFxuICAgICAgaXNSZXNvdXJjZUVycm9yLFxuICAgICAgaXNPdXRwdXRFcnJvciBcbiAgICB9ID0gcmVxdWlyZSgnLi4vLi4vLi4vc3JjL3V0aWxzL2Vycm9yJyk7XG4gICAgXG4gICAgY29uc3QgZmlsZUVycm9yID0gY3JlYXRlRmlsZUVycm9yKCd0ZXN0Jyk7XG4gICAgXG4gICAgZXhwZWN0KGlzRmlsZUVycm9yKGZpbGVFcnJvcikpLnRvQmUodHJ1ZSk7XG4gICAgZXhwZWN0KGlzUGFyc2VFcnJvcihmaWxlRXJyb3IpKS50b0JlKGZhbHNlKTtcbiAgICBleHBlY3QoaXNSZXNvdXJjZUVycm9yKGZpbGVFcnJvcikpLnRvQmUoZmFsc2UpO1xuICAgIGV4cGVjdChpc091dHB1dEVycm9yKGZpbGVFcnJvcikpLnRvQmUoZmFsc2UpO1xuICAgIFxuICAgIC8vIOmdnuOCqOODqeODvOOCquODluOCuOOCp+OCr+ODiOOBp2ZhbHNlXG4gICAgZXhwZWN0KGlzRmlsZUVycm9yKG51bGwpKS50b0JlKGZhbHNlKTtcbiAgICBleHBlY3QoaXNGaWxlRXJyb3IodW5kZWZpbmVkKSkudG9CZShmYWxzZSk7XG4gICAgZXhwZWN0KGlzRmlsZUVycm9yKHt9KSkudG9CZShmYWxzZSk7XG4gIH0pO1xufSk7Il0sInZlcnNpb24iOjN9